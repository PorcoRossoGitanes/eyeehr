<html>
	<head>
	    <meta content="text/html" charset="UTF-8">
    	<script src="js/jquery-2.1.1.js"></script>
		<script type="text/javascript" src="js/raphael-min.js"></script>
		<style>
#svg 
{
    width: 590px;
    height: 300px;
    background: #eee;
}
		</style>
	</head>
	<body>
		<ul>
			<li>フリーハンド（太さ変更）</li>
			<li>ハッチング（太さ変更）</li>
			<li>背景</li>
			<li>削除</li>
		</ul>

		<script type="text/javascript">
$(function(){
    // キャンバスを設定する。
    // 幅
    var stageW = 590;
    // 高さ
    var stageH = 300;
    // キャンバス
    var paper = Raphael("svg", stageW, stageH);
    // //円を描画（x:150, y:100の位置にサイズ50）
    // var circle = paper.circle(150, 100, 50);

//------------------------------
	//　パス
   	var path = undefined;
	// マウスのクリック状態（クリック時、true）
    var clicked = false;
    // パスの座標データ（格納用）
    var d = "";
    // 直前の座標(prevX,prevY) 現在の座標(x,y)
   	var prevX = undefined, prevY = undefined;
   	var x = undefined, y = undefined;

   	$('#svg').mousedown(function(e){ startDrawing(); });
    $('#svg').bind('touchstart', function(e){ startDrawing();});

    /// 描画開始
   	function startDrawing () 
   	{
   		//alert('startDrawing');		
	   	prevX = undefined;
	   	prevY = undefined;
   		clicked = true;
   		d = "";   
   	}

   	$('#svg').mouseup(function(e){ stopDrawing(); });
    $('#svg').bind('touchend', function(e){ stopDrawing();});

    /// 描画停止
   	function stopDrawing ()
   	{
   		clicked = false;
   		path = undefined;
   		//alert('stopDrawing');
   	}

    $('#svg').mousemove(function(e){
    	draw(e.clientX - $(this).position().left, e.clientY - $(this).position().top); 
 	});
    $('#svg').bind('touchmove', function(e){ 
    	event.preventDefault();
    	draw(
    		event.changedTouches[0].pageX - $(this).position().left, 
    		event.changedTouches[0].pageY - $(this).position().top
    	); 
    });

    function draw (currentX, currentY) 
    {
    	// alert('draw');
    	// クリック中はフリーハンドでライン／ハッチングを描ける
    	if (clicked)
    	{
	    	x = currentX;
	    	y = currentY;
	    	prevX = prevX === undefined ? x : prevX; 
	    	prevY = prevY === undefined ? y : prevY;

    		d = (d == "") ? 
    			("M" + prevX + "," + prevY + " " + "L" + x + "," + y) : 
    			(d + " " + "L" + x + "," + y);

    		if (path === undefined)
    		{
	    		path =  paper.path(d);
	    		path.attr('stroke-width', 10);
    		}
    		else 
    		{
    			path.attr('path', d);
    		}

    		path.mousedown(function (){
    			this.remove();
    		})

    	}
    }
});
//------------------------------
		</script>
		<!--SVGキャンバス部-->
		<div id="svg"></div>
		<script type="text/javascript">

		</script>

		<!-- Data Schemeを出力する。 -->
		<button id="DATA_SCHEME">Data Schemeで出力</button>
		<!-- SVGタグを出力する。 -->
		<button id="SVG_SRC">SVGタグ出力</button>
		<script>
$('#SVG_SRC').click(function(){
	$('textarea').text($('div#svg').html());
	$('div#displaySVG').html($('div#svg').html());
});
		</script>
		<textarea></textarea>
		<div id="displaySVG" ></div>

		<!--そのままSVGタグを取得すれば、画像は抽出できる-->
		<!--svg height="300" version="1.1" width="590" xmlns="http://www.w3.org/2000/svg" style="overflow: hidden; position: relative;"><desc>Created with Raphaﾃｫl 2.1.2</desc><defs></defs><circle cx="150" cy="100" r="50" fill="none" stroke="#000"></circle></svg-->
	</body>
</html>